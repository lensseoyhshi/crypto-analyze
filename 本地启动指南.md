# ğŸš€ æœ¬åœ° Mac å¯åŠ¨æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ Mac ç¬”è®°æœ¬ä¸Šå¯åŠ¨å’Œè¿è¡Œ crypto-analyze é¡¹ç›®ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

### 1. å®‰è£… Python 3.11+

æ£€æŸ¥ Python ç‰ˆæœ¬ï¼š
```bash
python3 --version
```

å¦‚æœç‰ˆæœ¬ä½äº 3.11ï¼Œä½¿ç”¨ Homebrew å®‰è£…ï¼š
```bash
brew install python@3.11
```

### 2. å®‰è£… MySQL 8.0

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Homebrew å®‰è£…ï¼ˆæ¨èæœ¬åœ°å¼€å‘ï¼‰**
```bash
# å®‰è£… MySQL
brew install mysql

# å¯åŠ¨ MySQL æœåŠ¡
brew services start mysql

# è®¾ç½® root å¯†ç ï¼ˆé¦–æ¬¡å®‰è£…ï¼‰
mysql_secure_installation
```

**æ–¹å¼äºŒï¼šä½¿ç”¨ Docker è¿è¡Œ MySQLï¼ˆæ¨èï¼Œæ›´ç®€å•ï¼‰**
```bash
docker run --name crypto-mysql \
  -e MYSQL_ROOT_PASSWORD=12345678 \
  -e MYSQL_DATABASE=crypto_analyze \
  -e MYSQL_USER=crypto_user \
  -e MYSQL_PASSWORD=crypto_pass \
  -p 3306:3306 \
  -d mysql:8.0

# æŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸ
docker ps
```

## ğŸ› ï¸ é¡¹ç›®é…ç½®

### 1. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /Users/shizhenqiang/code/Python/jiaoyi/crypto/crypto-analyze
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ä½†æ¨èï¼‰
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# é€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼ˆéœ€è¦æ—¶ä½¿ç”¨ï¼‰
# deactivate
```

### 3. å®‰è£…ä¾èµ–
```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨ pip
pip install -r requirements.txt

# æ–¹å¼äºŒï¼šä½¿ç”¨ Makefile
make install
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
cp .env.example .env

# æˆ–ç›´æ¥åˆ›å»ºæ–°çš„ .env æ–‡ä»¶
cat > .env << 'EOF'
# åº”ç”¨é…ç½®
APP_NAME=crypto-analyze
DEBUG=True

# æ•°æ®åº“é…ç½®ï¼ˆæ ¹æ®ä½ çš„ MySQL é…ç½®ä¿®æ”¹ï¼‰
DATABASE_URL=mysql+aiomysql://root:12345678@localhost:3306/crypto_analyze

# API å¯†é’¥
BIRDEYE_API_KEY=9c1c446225f246f69ec5ebd6103f1502

# è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰
DEXSCREENER_FETCH_INTERVAL=6
BIRDEYE_NEW_LISTINGS_INTERVAL=60
BIRDEYE_TOKEN_OVERVIEW_INTERVAL=300
BIRDEYE_TOKEN_SECURITY_INTERVAL=3600
BIRDEYE_TOKEN_TRANSACTIONS_INTERVAL=120
BIRDEYE_TOP_TRADERS_INTERVAL=300
BIRDEYE_WALLET_PORTFOLIO_INTERVAL=600

# è¿½è¸ªé…ç½®ï¼ˆå¯é€‰ï¼Œé€—å·åˆ†éš”ï¼‰
TRACKED_TOKENS=
TRACKED_WALLETS=
TRACK_NEW_LISTINGS_SECURITY=True
TRACK_NEW_LISTINGS_OVERVIEW=True
EOF
```

**é‡è¦é…ç½®è¯´æ˜ï¼š**
- `DATABASE_URL`: æ ¹æ®ä½ çš„ MySQL é…ç½®ä¿®æ”¹ç”¨æˆ·åã€å¯†ç ã€ä¸»æœºå’Œæ•°æ®åº“å
- `BIRDEYE_API_KEY`: Birdeye API å¯†é’¥ï¼ˆå·²æä¾›é»˜è®¤å€¼ï¼‰
- `DEBUG=True`: å¼€å‘æ¨¡å¼ï¼Œä¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„æ—¥å¿—

### 5. åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

```bash
# ç™»å½• MySQL
mysql -u root -p

# åœ¨ MySQL ä¸­æ‰§è¡Œ
CREATE DATABASE IF NOT EXISTS crypto_analyze CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

æˆ–è€…ä½¿ç”¨ Docker MySQLï¼š
```bash
docker exec -it crypto-mysql mysql -uroot -p12345678 -e "CREATE DATABASE IF NOT EXISTS crypto_analyze CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

### 6. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨ alembic ç›´æ¥è¿è¡Œ
alembic upgrade head

# æ–¹å¼äºŒï¼šä½¿ç”¨ Makefile
make migrate
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜è¿ç§»æˆåŠŸï¼š
```
INFO  [alembic.runtime.migration] Running upgrade  -> 0001_initial
INFO  [alembic.runtime.migration] Running upgrade 0001_initial -> 0002_add_detailed_tables
```

## ğŸš€ å¯åŠ¨åº”ç”¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ uvicorn ç›´æ¥å¯åŠ¨ï¼ˆæ¨èå¼€å‘ï¼‰
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Makefile å¯åŠ¨
```bash
make dev
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Docker Composeï¼ˆå®Œæ•´ç¯å¢ƒï¼‰
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ MySQLï¼‰
docker-compose up --build

# åå°è¿è¡Œ
docker-compose up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app
```

## âœ… éªŒè¯è¿è¡ŒçŠ¶æ€

### 1. æ£€æŸ¥åº”ç”¨å¯åŠ¨æ—¥å¿—

åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼š
```
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
2024-01-09 10:00:00 - app.main - INFO - Starting crypto-analyze
2024-01-09 10:00:00 - app.services.scheduler - INFO - Starting background tasks
2024-01-09 10:00:00 - app.services.scheduler - INFO - Tracking 0 tokens from config
2024-01-09 10:00:00 - app.services.scheduler - INFO - Started Dexscreener poller (interval: 6s)
2024-01-09 10:00:00 - app.services.scheduler - INFO - Started Birdeye new listings (interval: 60s)
...
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 2. è®¿é—® API ç«¯ç‚¹

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **API æ–‡æ¡£**: http://localhost:8000/docs
  - äº¤äº’å¼ Swagger UIï¼Œå¯ä»¥æµ‹è¯•æ‰€æœ‰ API
  
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
  ```json
  {
    "status": "ok",
    "app": "crypto-analyze",
    "debug": true
  }
  ```

- **æ ¹è·¯å¾„**: http://localhost:8000/
  ```json
  {
    "message": "Crypto Analyze API",
    "docs": "/docs",
    "health": "/health",
    "data": {
      "responses": "/data/responses",
      "stats": "/data/stats",
      "sources": "/data/sources"
    }
  }
  ```

### 3. æŸ¥çœ‹æ•°æ®é‡‡é›†æ—¥å¿—

åº”è¯¥çœ‹åˆ°å®šæœŸçš„æ•°æ®é‡‡é›†æ—¥å¿—ï¼š
```
[Dexscreener] Fetching top boosts (poll #1)
[Dexscreener] Saved 25 boosts (poll #1)
[Async] Fetching token security for So11111...
[Async] Fetching token transactions for So11111...
[Birdeye] Fetching new listings (poll #1)
[Birdeye] Saved/Updated 50 new listings (poll #1)
```

### 4. æ£€æŸ¥æ•°æ®åº“æ•°æ®

```bash
# ç™»å½• MySQL
mysql -u root -p crypto_analyze

# æŸ¥çœ‹è¡¨
SHOW TABLES;

# æŸ¥çœ‹é‡‡é›†çš„æ•°æ®
SELECT COUNT(*) FROM raw_api_responses;
SELECT COUNT(*) FROM dexscreener_token_boosts;
SELECT COUNT(*) FROM birdeye_new_listings;

# æŸ¥çœ‹æœ€æ–°çš„ token boosts
SELECT tokenAddress, description, totalAmount, created_at 
FROM dexscreener_token_boosts 
ORDER BY created_at DESC 
LIMIT 10;
```

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
# å¦‚æœä½¿ç”¨ uvicorn å¯åŠ¨ï¼Œæ—¥å¿—ä¼šç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯

# å¦‚æœä½¿ç”¨ Docker Compose
docker-compose logs -f app
```

### åœæ­¢åº”ç”¨
```bash
# å¦‚æœä½¿ç”¨ uvicornï¼ŒæŒ‰ Ctrl+C

# å¦‚æœä½¿ç”¨ Docker Compose
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®ï¼ˆé‡ç½®æ•°æ®åº“ï¼‰
docker-compose down -v
```

### é‡å¯åº”ç”¨
```bash
# é‡æ–°è¿è¡Œå¯åŠ¨å‘½ä»¤

# æˆ–ä½¿ç”¨ Docker Compose
docker-compose restart app
```

### æŸ¥çœ‹åå°ä»»åŠ¡çŠ¶æ€

åå°ä»»åŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨ï¼ŒåŒ…æ‹¬ï¼š
1. âœ… Dexscreener è½®è¯¢ï¼ˆæ¯ 6 ç§’ï¼‰
2. âœ… Birdeye æ–°å¸åˆ—è¡¨ï¼ˆæ¯ 60 ç§’ï¼‰
3. âœ… Token æ¦‚è§ˆï¼ˆæ¯ 300 ç§’ï¼‰
4. âœ… Top Tradersï¼ˆæ¯ 300 ç§’ï¼‰
5. âœ… é’±åŒ…æŒä»“ï¼ˆæ¯ 600 ç§’ï¼‰

ä½ åº”è¯¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°è¿™äº›ä»»åŠ¡çš„æ‰§è¡Œè®°å½•ã€‚

## ğŸ“Š æ•°æ®é‡‡é›†ç‰¹æ€§

### è‡ªåŠ¨å»é‡å’Œæ›´æ–°

æ‰€æœ‰å…³é”®æ•°æ®è¡¨éƒ½å®ç°äº† Upsertï¼ˆå­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™æ’å…¥ï¼‰ï¼š

| æ•°æ®è¡¨ | å”¯ä¸€é”® | è¯´æ˜ |
|--------|--------|------|
| DexscreenerTokenBoost | tokenAddress | ä»£å¸ Boost æ•°æ® |
| BirdeyeTokenSecurity | token_address | ä»£å¸å®‰å…¨æ£€æµ‹ |
| BirdeyeTokenTransaction | txHash | äº¤æ˜“è®°å½• |
| BirdeyeNewListing | address | æ–°ä¸Šå¸ |
| BirdeyeTopTrader | tokenAddress + owner | é¡¶çº§äº¤æ˜“è€… |
| BirdeyeWalletToken | wallet_address + token_address | é’±åŒ…æŒä»“ |

### å¼‚æ­¥å¹¶å‘é‡‡é›†

- Dexscreener é‡‡é›†åˆ°çš„æ¯ä¸ª tokenï¼Œä¼šè‡ªåŠ¨è§¦å‘ï¼š
  - âœ… å®‰å…¨æ£€æµ‹ï¼ˆæ£€æµ‹è²”è²…å¸ï¼‰
  - âœ… äº¤æ˜“è®°å½•é‡‡é›†
  
- è¿™äº›ä»»åŠ¡å¼‚æ­¥å¹¶å‘æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»è½®è¯¢

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2003, "Can't connect to MySQL server...")
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ MySQL æ˜¯å¦è¿è¡Œ
mysql -u root -p

# æˆ–æ£€æŸ¥ Docker MySQL
docker ps | grep mysql

# é‡å¯ MySQLï¼ˆHomebrewï¼‰
brew services restart mysql

# é‡å¯ MySQLï¼ˆDockerï¼‰
docker restart crypto-mysql

# æ£€æŸ¥ .env ä¸­çš„ DATABASE_URL æ˜¯å¦æ­£ç¡®
cat .env | grep DATABASE_URL
```

### é—®é¢˜ 2: æ¨¡å—å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ModuleNotFoundError: No module named 'fastapi'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é—®é¢˜ 3: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
OSError: [Errno 48] Address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ 8000 ç«¯å£çš„è¿›ç¨‹
lsof -i :8000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£å¯åŠ¨
uvicorn app.main:app --reload --port 8001
```

### é—®é¢˜ 4: æ•°æ®åº“è¿ç§»å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥å½“å‰è¿ç§»ç‰ˆæœ¬
alembic current

# é‡ç½®æ•°æ®åº“ï¼ˆè­¦å‘Šï¼šä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
make db-reset

# æˆ–æ‰‹åŠ¨é‡ç½®
docker-compose down -v
docker-compose up -d db
sleep 5
alembic upgrade head
```

### é—®é¢˜ 5: API å¯†é’¥æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
[Birdeye] Failed to fetch: 401 Unauthorized
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ API å¯†é’¥
cat .env | grep BIRDEYE_API_KEY

# ç¡®ä¿å¯†é’¥æœ‰æ•ˆï¼Œæˆ–è”ç³» Birdeye è·å–æ–°å¯†é’¥
```

## ğŸ“ Makefile å¿«æ·å‘½ä»¤

```bash
make help              # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
make install           # å®‰è£…ä¾èµ–
make dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
make test             # è¿è¡Œæµ‹è¯•
make lint             # ä»£ç æ£€æŸ¥
make format           # æ ¼å¼åŒ–ä»£ç 
make clean            # æ¸…ç†ç¼“å­˜æ–‡ä»¶
make docker-up        # å¯åŠ¨ Docker æœåŠ¡
make docker-down      # åœæ­¢ Docker æœåŠ¡
make docker-logs      # æŸ¥çœ‹ Docker æ—¥å¿—
make migrate          # è¿è¡Œæ•°æ®åº“è¿ç§»
make migrate-create   # åˆ›å»ºæ–°è¿ç§»
make migrate-rollback # å›æ»šè¿ç§»
make db-reset         # é‡ç½®æ•°æ®åº“
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é…ç½®è¿½è¸ªçš„é’±åŒ…å’Œä»£å¸**
   - ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ  `TRACKED_TOKENS` å’Œ `TRACKED_WALLETS`
   
2. **è°ƒæ•´è½®è¯¢é—´éš”**
   - æ ¹æ®éœ€è¦ä¿®æ”¹å„ä¸ª `_INTERVAL` é…ç½®
   
3. **æŸ¥çœ‹ API æ–‡æ¡£**
   - è®¿é—® http://localhost:8000/docs
   - å°è¯•å„ç§ API ç«¯ç‚¹
   
4. **ç›‘æ§æ•°æ®é‡‡é›†**
   - è§‚å¯Ÿæ—¥å¿—è¾“å‡º
   - æŸ¥è¯¢æ•°æ®åº“éªŒè¯æ•°æ®
   
5. **å¼€å‘æ–°åŠŸèƒ½**
   - å‚è€ƒ `PROJECT_SUMMARY.md` äº†è§£æ¶æ„
   - æŸ¥çœ‹ `DATABASE_SCHEMA.md` äº†è§£æ•°æ®ç»“æ„

## ğŸ’¡ æç¤º

- **å¼€å‘æ¨¡å¼**ï¼šè®¾ç½® `DEBUG=True` å¯ä»¥çœ‹åˆ°æ›´è¯¦ç»†çš„æ—¥å¿—
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯ä»¥è°ƒæ•´å„ä¸ªè½®è¯¢é—´éš”æ¥æ§åˆ¶ API è°ƒç”¨é¢‘ç‡
- **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ MySQL æ•°æ®åº“
- **ç›‘æ§èµ„æº**ï¼šä½¿ç”¨ `top` æˆ– `htop` ç›‘æ§ CPU å’Œå†…å­˜ä½¿ç”¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°å’ŒåŠŸèƒ½è¯´æ˜
- [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md) - æ•°æ®åº“ç»“æ„è¯¦è§£
- [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md) - é¡¹ç›®æ¶æ„è¯´æ˜
- [GETTING_STARTED.md](GETTING_STARTED.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—

## â“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ‰¾åˆ°é”™è¯¯ä¿¡æ¯
2. å‚è€ƒ"æ•…éšœæ’æŸ¥"éƒ¨åˆ†
3. æ£€æŸ¥ GitHub Issues
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼Happy Coding! ğŸ‰**

